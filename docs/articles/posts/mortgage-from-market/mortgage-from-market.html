<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Josh Pearlson">
<meta name="dcterms.date" content="2025-11-22">

<title>Getting a Mortgage from the Market – Josh Pearlson</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../media/jcp_logo2.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../css/header.css">
<link rel="stylesheet" href="../../../css/posts.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../media/jcp_logo3.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Josh Pearlson</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../articles/blog.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../projects/projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../aboutPage/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Getting a Mortgage from the Market</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Finance</div>
                <div class="quarto-category">Options</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Josh Pearlson </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 22, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Articles showcase a select group using options to borrow money rather than a traditional Agency mortgage. Are advertisements of $0 down and near treasury-rate mortgages a fact or fiction?</p>
<hr>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../media/mortgageMarketHeader.png" class="img-fluid figure-img"></p>
<figcaption>Mortgage from the Market</figcaption>
</figure>
</div>
<p>Imagine securing a loan for your dream home with a 0% down payment and an interest rate that rivals the U.S. Treasury. It sounds like a financial fantasy, but a niche corner of the options market, the ‘box spread’, has been touted online as a secret Wall Street trick to do just that. But is this a golden ticket for the average homebuyer, or a high-stakes gamble reserved for a select few? Let’s break down the math, the hype, and the hidden dangers.</p>
<p>Today the average 30-year fixed rate mortgage is around <a href="https://finance.yahoo.com/personal-finance/mortgages/article/mortgage-refinance-rates-today-thursday-november-20-2025-110030633.html?utm_source=chatgpt.com&amp;guccounter=1&amp;guce_referrer=aHR0cHM6Ly9jaGF0Z3B0LmNvbS8&amp;guce_referrer_sig=AQAAAGThrdddEj7J49b2DIvcxNFIX9q4DI1ccJvBuVneynvn5U9rVmMrs-uBmQ8tCZVZyPfk0uTu0i0Frgl5jbbCwGEqric4V2QxIsW8kq6QF4d280RB4vYzTpDpPrtEe230APncCw1ufLbZputPUC7NGxXCpBMxl02T61-VZw3ciI-f">6.3%</a> yearly. Generally for mortgages it is recommended that buyers have around 20% to put as a ‘down payment’ at the start of the mortgage term. When trying to purchase a $1M house the math looks like the following:</p>
<p>Home cost: <br> <strong>$1M</strong> <br> Down payment: <br> 20% * $1M = <strong>$200K</strong> <br> Loan value: <br> $1M - $200K = <strong>$800K</strong> <br> Interest rate monthly: <br> 6.3%/12 = <strong>.525% monthly</strong> <br> Length of payments in months: <br> 30 years * 12 = <strong>360 months</strong> <br> Monthly payment: <br> $800K * .525% / (1-(1 + .525%)^-360) = <strong>$4,951.78</strong> <br> Total interest paid: <br> $4,951.78 * 360 - $800K = <strong>$982,640.8</strong></p>
<p>There are good and bad things associated with this:</p>
<p><strong>[good]</strong> <br></p>
<ol type="1">
<li><p>You have effectively lowered the initial cost burden of purchasing a home. Now instead of paying $1M today, I can pay $200K today and own a home for $5K in fixed payments per month.</p></li>
<li><p>I get to enjoy the appreciation of equity value if my house raises in value. If rates decline or my home value increases, I may then be able to re-finance my home enjoying even lower rates or payments.</p></li>
</ol>
<p><strong>[bad]</strong><br></p>
<ol type="1">
<li><p>I have to come up with $200K today. This may not be a problem for me financially, however, I don’t want to have to sell large chunks of stocks or my retirement accounts in order to get the cash on hand.</p></li>
<li><p>If I for some reason cannot make my payments the bank will take my house. I will lose all of the value I had built up in home equity and still have paid lots of principal and interest for nothing.</p></li>
<li><p>If I keep to my payments and everything goes according to plan I will likely have a $800K loan that costs me $982K in interest over time to borrow that money. That is a ton of interest, more than 120% of the loan value spent and pocketed by a bank.</p></li>
</ol>
<section id="the-box-spread-mortgage" class="level2">
<h2 class="anchored" data-anchor-id="the-box-spread-mortgage">The Box Spread Mortgage</h2>
<p>First let’s clarify, I am not suggesting you do this. In fact, today I am going to argue why this is not the Goldilocks scenario it is documented as in articles online. Please do not take this article as advice to go out and try and trade millions of dollars of notional volume of options to try and create yourself one of these.</p>
<p>Now that that is out of the way, here is the box spread mortgage:</p>
<blockquote class="blockquote">
<p>A <strong>box-spread mortgage</strong> is a synthetic borrowing mechanism in which a long-dated options box spread provides capital upfront in exchange for a contractually fixed repayment at maturity, effectively replicating a mortgage’s economic profile via derivative pricing.</p>
</blockquote>
<section id="creating-a-box-spread-mortgage" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-box-spread-mortgage">Creating a Box Spread Mortgage</h3>
<p>Simply put to create a box spread we go long a call and short a put option at a strike <span class="math inline">\(k_1\)</span> and short a call and long a put at strike <span class="math inline">\(k_2\)</span>. At strike <span class="math inline">\(k_1\)</span> you have effectively created a synthetic long forward. At strike <span class="math inline">\(k_2\)</span> you have created a short forward.</p>
<p>It is important that the options that comprise this trade are European options. American options allow for exercising an option early, allowing for your ‘balanced hedge’ to fall apart whenever your counterparty decides.</p>
<p>Going long a forward is equivalent to agreeing to buy an asset at a fixed-price <span class="math inline">\(k_1\)</span> in the future. Going short a forward is agreeing to sell an asset at a fixed-price <span class="math inline">\(k_2\)</span> in the future.</p>
<p>Thus, when <span class="math inline">\(k_2\)</span> &gt; <span class="math inline">\(k_1\)</span> we receive a fixed future payoff of <span class="math inline">\(k_2 - k_1\)</span>. We also collect upfront the present value of this payoff discounted at the risk-free rate (or 10s of bps higher as market makers need to profit) this upfront cash flow is <span class="math inline">\(PV(k_2 - k_1)\)</span>.</p>
<p>So in this trade we get paid <span class="math inline">\(PV(k_2 - k_1)\)</span> and have to pay <span class="math inline">\(k_2 - k_1\)</span> in the future. This is the exact same as borrowing <span class="math inline">\(k_2 - k_1\)</span> dollars at/near the risk-free interest rate <span class="math inline">\(r_f\)</span>.</p>
<p>In simpler terms you can think of it this way: you simultaneously make two deals for a future date.</p>
<ol type="1">
<li><p>Deal 1: You agree to buy an asset for $1,000.</p></li>
<li><p>Deal 2: You agree to sell the exact same asset for $1,050.</p></li>
</ol>
<p>No matter what the asset’s price is on that future date, you are guaranteed to make a $50 profit. The market recognizes this guaranteed future profit and gives you its present value today: say, $48 as cash in your pocket.</p>
<p>Congratulations, you’ve just received $48 upfront in exchange for paying back $50 later. In essence, you’ve taken out a loan at a very low interest rate, with the loan amount being the present value of the spread between your two deals.</p>
</section>
<section id="how-much" class="level3">
<h3 class="anchored" data-anchor-id="how-much">How Much?</h3>
<p>Just how far from <span class="math inline">\(r_f\)</span> can you borrow? Due to recent increase in volume in the SPX box spread market, this <a href="https://www.cboe.com/insights/posts/long-dated-box-spreads-a-better-way-to-buy-a-home-updated/">CBOE article</a> (which I recommend reading if you are interested in this) says to expect 30-50bps higher than treasury rates! This is astonishingly low with the 5yr sitting at 3.6% on the high end you could expect to borrow at <strong>4.1% interest</strong>! This is 2.2% lower than the traditional mortgage I showed earlier.</p>
<p>Not to mention there are other benefits as well. I mentioned that you get paid upfront whatever you want, let’s say the full 1M value of the home. In 5 years you repay <span class="math inline">\(\$1M * (1.041)^5 = \$1,222,513.45\)</span>. Costing you ~200K to loan 1M over 5 years. At the comparable interest rate for the traditional mortgage this would cost around <span class="math inline">\(\$1M * (1.063^5) - \$1M = \$357k\)</span>. No monthly payments as well with the box spread, just the lump sum payment at a future date of over a million dollars.</p>
</section>
<section id="all-the-problems" class="level3">
<h3 class="anchored" data-anchor-id="all-the-problems">All the Problems</h3>
<p>Ok first off in order to actually get one of these box loans your strategy (as a retail trader) will need to be fully collateralized at all times. This means if you are to do the $1M loan you need $1.2M+ in assets in your same brokerage account at all times. This is ok for some people however it requires a lot of capital depending on how volatile a person’s investments are.</p>
<p>I would also guess that there is a correlation between using a box spread as a mortgage and having a higher risk appetite, but I digress.</p>
<p>In a bad market downturn the stock market can fall ~50% so to be safe let’s say we will need to have $2.4M in equities or less if you are including less volatile fixed-income products as well. Immediately we have moved from ‘easily accessible risk-free rate mortgage’ to ‘you need double or more in retirement assets to reasonably attempt this’.</p>
<p>Let’s say we are fully collateralized, we are very certain we will be able to meet the liability in 5 years safely. Now we have another problem, we have to meet a 5 year liability of greater than our loan size settled in pure cash! If you were worried about selling 20% of your home value in portfolio value how about selling 120% of your home value in portfolio value in just 5 years!</p>
<p>Now this is not fully fair as there are likely strategies to ‘kick the cash flow down the road’ like rolling into a new 5 year box spread borrowing the new amount (collateralized fully by at least a 2x multiple). However, it’s still said that at some point you need to present a large quantity of cash in order to settle this contract. The only way to come up with that level of cash is by selling assets or making incremental payments to set aside for the large future negative cash flow you expect. This is why in a traditional mortgage you are expected to pay down a fixed cost monthly which goes to both repaying interest and the principal which you loaned out.</p>
<p>In order to effectively execute this strategy you need to be very wealthy in retirement assets which you can use as collateral covering the loan size multiple times over if you have a more volatile portfolio. You also need to have a strategy to meet the expected large negative cash flow in the future.</p>
<p>If in 5 years, you need to have some plan to come up with $1.2M then rather than just coming up with the $1M today? Given you are this consumer who has vast riches in assets and is not concerned with the future cash liability why not just pay off the house today? Pushing the house/sale of retirement assets out 5 years even at the risk-free rate does not seem as worth it for this consumer since they <strong>already have more than enough money for the loan anyway</strong>.</p>
<p>Well, there are some reasons. Here are the reasons why you would want to do this. First, the interest payments show up as a loss in an options trade. This <strong>loss is tax deductible</strong>! This means if you are wealthy you can likely write off a large portion of the interest (leading to an almost free loan). So let’s say you are fully collateralized with an investment account however you expect to have to sell off some assets in 5 years that have appreciated (incurring a capital gains tax). You also happen to be making a large purchase that you could have done outright anyway. Now we have a great scenario for you to go out to the market, borrow money using box spreads, and then generate a loss at the end of the period allowing you to:</p>
<ol type="1">
<li><p>Borrow money today so that you don’t have to sell assets.</p></li>
<li><p>Align your planned sale of assets (likely with capital gains tax) and offset it with the loss you will generate in the synthetic loan strategy (interest payment).</p></li>
<li><p>Pay off the full cost of the loan at the end of the period rather than the start.</p></li>
</ol>
<p>This now looks like a great trade.</p>
<p>Once again though I want to reiterate, this is not a good strategy for people who are under-collateralized. It is in fact an awful strategy. If the market drops and your collateral falls bellow whatever threshold your broker allows you wont be losing some fancy new home, you will be losing your life savings (and all investments). This is not a good trade for that level of risk.</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>There is a select group who could benefit from the box spread mortgage (or loan).</p>
<p>This select group is over-collateralized, has planned selling with tax implications in the future, and wants to make a purchase today. This group is <strong>not the everyday person</strong>, in fact far from it! Most people get a mortgage because they want to convert the large upfront cost burden of owning a home to a delayed fixed cost burden spread over many years.</p>
<p>This consumer does not have enough to buy the house outright and likely does not have enough to buy several of the house within their retirement assets. Thus, if they tried the box spread mortgage they would likely get margin called during a large drawdown in the equity markets and lose everything.</p>
<p>As always, till next time.</p>
<p>JCP</p>


</section>
</section>

</main> <!-- /main -->
<script>
  <!-- A message to others like me! -->
  console.log("Nice, I also love checking on page elements!");
  console.log("If you're reading this, awesome!");
  console.log(
    "Interested in learning how to make sites like this? Check out quarto.org",
  );
  console.log("They have awesome docs and are a great place to start form!");
  console.log("Signing off. -JP");
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Don't run on the main listing page
  if (document.querySelector('.quarto-listing-container-default')) {
    return;
  }

  const contentArea = document.querySelector('main#quarto-document-content');
  if (!contentArea) {
    return; // Exit if the main content area isn't found
  }

  // --- 1. GATHER METADATA ---
  const title = document.querySelector('.quarto-title.column-body h1.title')?.textContent.trim() || 'Article';
  let author = 'Josh Pearlson'; // Default author
  let date = ''; // Default date
  const url = window.location.href;

  const metaHeadings = document.querySelectorAll('.quarto-title-meta-heading');
  metaHeadings.forEach(heading => {
    const headingText = heading.textContent.trim();
    const contentsEl = heading.nextElementSibling;
    if (contentsEl && contentsEl.classList.contains('quarto-title-meta-contents')) {
      if (headingText === 'Author') {
        author = contentsEl.querySelector('p')?.textContent.trim() || author;
      }
      if (headingText === 'Published') {
        date = contentsEl.querySelector('p.date')?.textContent.trim() || date;
      }
    }
  });

  // --- 2. CREATE THE SHARE BUTTON ---
  const shareContainer = document.createElement('div');
  shareContainer.className = 'share-article-container';

  const shareButton = document.createElement('button');
  shareButton.className = 'share-article-button';
  shareButton.textContent = 'Share this Article';

  shareContainer.appendChild(shareButton);
  contentArea.appendChild(shareContainer);

  // --- 3. ADD CLICK EVENT LISTENER ---
  shareButton.addEventListener('click', function() {
    const shareText = `"${title}" by ${author} (Published: ${date}): ${url}`;

    navigator.clipboard.writeText(shareText).then(() => {
      // --- 4. PROVIDE FEEDBACK ---
      const originalText = shareButton.textContent;
      shareButton.textContent = 'Copied to clipboard!';
      shareButton.classList.add('copied');

      setTimeout(() => {
        shareButton.textContent = originalText;
        shareButton.classList.remove('copied');
      }, 3000); // Revert after 3 seconds
    }).catch(err => {
      console.error('Failed to copy text: ', err);
      // Optional: Provide error feedback to the user
      const originalText = shareButton.textContent;
      shareButton.textContent = 'Copy failed!';
      setTimeout(() => {
        shareButton.textContent = originalText;
      }, 3000);
    });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Only run on post pages (where there is a title banner)
  if (!document.querySelector('.quarto-title-banner')) {
    return;
  }

  const mainContainer = document.querySelector('#quarto-content');
  const articleContent = mainContainer.querySelector('main#quarto-document-content');
  const headings = articleContent.querySelectorAll('h2, h3');

  if (!mainContainer || !articleContent || headings.length < 2) {
    return; // Exit if key elements are missing or not enough headings
  }

  // --- 1. CREATE THE TOC STRUCTURE ---
  const tocNav = document.createElement('nav');
  tocNav.className = 'scrollspy-nav';

  const tocList = document.createElement('ol');
  tocList.className = 'scrollspy-list';

  headings.forEach(heading => {
    if (!heading.id) {
      // Assign an ID if the heading doesn't have one
      const slug = heading.textContent.trim().toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]+/g, '');
      heading.id = slug;
    }

    const tocItem = document.createElement('li');
    tocItem.className = `scrollspy-item toc-level-${heading.tagName.toLowerCase()}`;

    const tocLink = document.createElement('a');
    tocLink.href = `#${heading.id}`;
    tocLink.textContent = heading.textContent;
    tocLink.className = 'scrollspy-link';

    tocItem.appendChild(tocLink);
    tocList.appendChild(tocItem);
  });

  tocNav.appendChild(tocList);
  // Insert the ToC as the first child of the main container
  mainContainer.prepend(tocNav);

  // --- 2. SETUP INTERSECTION OBSERVER ---
  const observerOptions = {
    root: null, // relative to the viewport
    rootMargin: '0px 0px -75% 0px', // Trigger when heading is in the top 25% of the viewport
    threshold: 1.0
  };

  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      const id = entry.target.getAttribute('id');
      const tocLink = document.querySelector(`.scrollspy-link[href="#${id}"]`);

      if (entry.isIntersecting && tocLink) {
        // Remove active from all, then add to the current one
        document.querySelectorAll('.scrollspy-link.active').forEach(link => link.classList.remove('active'));
        tocLink.classList.add('active');
      }
    });
  }, observerOptions);

  // Observe all the headings
  headings.forEach(heading => {
    observer.observe(heading);
  });
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>